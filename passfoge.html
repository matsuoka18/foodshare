<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>パスワードを忘れ</title>
        <link rel="stylesheet" href="home2.css">
          <script type="text/javascript"
        src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js">
</script>
<script type="text/javascript">
   (function(){
      emailjs.init("WIptzQo9RsrV7VK_G");
   })();
</script>
    </head>
    <body>
        <div class="name2">
            <h1>パスワードを忘れた</h1>
      <div class="name" onclick="location.href='index.html'">
      <p>foodshare</p>
          </div>
      </div>
      <div class="top">
        <h1>パスワードを再発行する</h1>
        <div class="top2">
        <p>名前を入力</p>
        <input type="text"id="name"value=""placeholder="名前を入力">
        </div>
        <div class="top2">
        <p>登録したメールアドレスを入力</p>
        <input type="text" id="mailad"value=""placeholder="メールアドレスを入力">
        </div>
        <button onclick="send()">送信</button>
        </div>
        <script>
        function send(){
        name2 = document.getElementById("name").value;
        adress = document.getElementById("mailad").value;
        fetch('https://script.google.com/macros/s/AKfycbwBH_VrPaXcJg8HOXfoWHJY8f0Ir3935fqlJlURpyAkd8IdEQ/exec',{
        method:"GET",
        mode:"cors"
        })
        .then(response =>{
        if(response.ok){
        return response.json();
        }
        })
        .then(resJson=>{
        json = JSON.stringify(resJson);
        json = JSON.parse(json);
         check(); 
        })
        .catch(error=>{
        alert("error");
        })
        }
        function check(){
        cn1 = json.logindata[0];
        sum = cn1.合計;
        for(var a = 0; a<sum; a++){
            search = "店舗"+a;
            shopname = cn1[search];
            if(name2 == shopname){
                console.log("店舗発見");
                scheck = '';
                getpassnumber = a;
                mailchack();
            }
        }
        if(typeof scheck == 'undefined'){
            alert("店舗を発見できまへんで");
        }
        }
        function mailchack(){
            search = "メールアドレス"+getpassnumber;
alert(search);
            adress2 = cn1[search];
alert(adress2);
            if(adress2 == adress){
                console.log("メールアドレス確認");
            passget();
}
}
        function passget(){
            search2 = "パスワード"+getpassnumber;
            pass2 = cn1[search2];
           mailsend();
        }
        //まずnameのやつがあるかをチェック次にメール送信→再設定のページを飛ばす 
        function mailsend(){
        var templateParams = {
    name: name2,
    pass: pass2,
    mail:adress
};
 
emailjs.send('service_ay90m8q', 'template_booi3af', templateParams)
    .then(function(response) {
       console.log('SUCCESS!', response.status, response.text);
alert("完了しました")
    }, function(error) {
       console.log('FAILED...', error);
    });
        }
        </script>
    </body>
</html>
